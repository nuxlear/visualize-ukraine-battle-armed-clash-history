<!DOCTYPE html>
<html>
    <head>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

        <title>Russian Invasion of Ukraine in 2022</title>
        <script src="https://d3js.org/d3.v7.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/d3-geo@3"></script>
        <script src="https://unpkg.com/topojson@3"></script>

        <script src="components/map.js"></script>
    </head>

    <body>
        <div style="border: 5px">
            <svg id="map"></svg>
        </div>
        <div width="1440">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="show-clash" checked>
                <label class="form-check-label" for="show-clash">
                Armed clash
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="show-overtake" checked>
                <label class="form-check-label" for="show-overtake">
                Non-state Actor overtakes territory
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" value="" id="show-regain" checked>
                <label class="form-check-label" for="show-regain">
                Government regains territory
                </label>
            </div>
        </div>
        
        <script>
            var width = 1440;
            var height = 900;
            
            var svg = d3.select('#map')
                .attr('width', width)
                .attr('height', height);
            var g = svg.append('g')
                .attr('width', width)
                .attr('height', height);
            
            var projection = d3.geoMercator()
                .center([32, 49])
                .scale(2800)
                .translate([width / 2, height / 2]);
            var path = d3.geoPath()
                .projection(projection);

            svg.call(
                d3.zoom().on('zoom', ({ transform }) => {
                    g.attr('transform', transform);
                })
            );
            
            d3.json('https://raw.githubusercontent.com/org-scn-design-studio-community/sdkcommunitymaps/master/geojson/Europe/Ukraine-regions.json').then(
                data => {
                    const regions = topojson.feature(data, data.objects.UKR_adm1);

                    g.selectAll('path')
                        .data(regions.features)
                        .enter()
                        .append('path')
                        .attr('d', path)
                        .attr('fill', 'grey')
                        .attr('stroke', 'white')
                        .attr('stroke-width', '1')
                        // .on('mouseover', 
                        // (e, d) => {
                        //     d.attr('fill', 'red');
                        // })
                        .append('title') // Add a tooltop
                        .text(d => d.properties.NAME_1);
                }
            ).then(
                d3.csv('output.csv').then(
                    data => {
                        // data = data.filter(d => d.sub_event_type != 'Armed clash')

                        colormap = ['#44444480', '#FF2222C0', '#22FF22C0']
                        let zScale = d3.scaleOrdinal()
                            .domain(['Armed clash', 'Non-state actor overtakes territory', 'Government regains territory'])
                            .range([0, 1, 2])
                            
                        console.log(data);

                        g.selectAll('circle')
                            .data(data)
                            .join('circle')
                            .attr('cx', d => projection([d.longitude, d.latitude])[0])
                            .attr('cy', d => projection([d.longitude, d.latitude])[1])
                            // .attr('fill', '#FF000080')
                            .attr('fill', d => colormap[zScale(d.sub_event_type)])
                            .attr('r', 3)
                            .style('z-index', d => zScale(d.sub_event_type) + 1)
                            .append('title')
                            .text(d => d.sub_event_type);
                    }
                )
            )
        </script>
    </body>
</html>